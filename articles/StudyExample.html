<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RiskStratifiedEstimation">
<title>Study example • RiskStratifiedEstimation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Study example">
<meta property="og:description" content="RiskStratifiedEstimation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RiskStratifiedEstimation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/StudyExample.html">Study example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Study example</h1>
                        <h4 data-toc-skip class="author">Alexandros
Rekkas and Peter R. Rijnbeek</h4>
            
            <h4 data-toc-skip class="date">2023-03-08</h4>
      
      
      <div class="d-none name"><code>StudyExample.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Generalizability of an overall result found in a study and
applicability to a specific patient move in opposite directions. When
patients differ from one another in many key determinants of the outcome
of interest–and consequently in the potential benefits and harms of
therapy–it can be unclear to whom the overall average benefit-harm
trade-offs actually apply. Precision medicine aims to tailor treatment
to individual patients. As such, analysis of heterogeneity of treatment
effect (HTE), i.e. non-random variation in the direction or magnitude of
a treatment effect for individuals within a population, is the
cornerstone of precision medicine; its goal is to predict the optimal
treatments at the individual level, accounting for an individual’s risk
for harm and benefit outcomes.</p>
<p>This vignette describes the application of a risk modeling predictive
approach to the assessment of treatment effect heterogeneity (HTE) using
the <code>RiskStratifiedEstimation</code> package. The method involves 4
main steps summarized in Figure <span class="math inline">\(\ref{workflow}\)</span>:</p>
<ul>
<li>
<strong>Definition of the problem:</strong> For this step we need to
define (at least) 3 essential cohorts: (1) the treatment cohort,
containing the set of patients receiving the treatment treatment
interest; (2) the comparator cohort, containing the set of patients
receiving the comparator cohort; (3) the outcome cohort(s), containing
the set of patients having the outcome(s) of interest.</li>
<li>
<strong>Identification of the database:</strong> We need to define
the database(s) on which we will assess treatment effect heterogeneity.
We need to make sure that the cohorts created contain enough patients to
proceed with the application of the method.</li>
<li>
<strong>Prediction step:</strong> Combine the treatment and
comparator cohorts into a single cohort for prediction and then provide
the settings required for prediction based on the
<code>PatientLevelPrediction</code> package. This means that we need to
define the time-at-risk (time interval within which we want to predict),
the set of predictive covariates and the prediction algorithm to be used
(along with its settings).</li>
<li>
<strong>Estimation step:</strong> Divide the treatment population in
a pre-specified number of equal-sized strata based on baseline risk and
estimate the absolute and relative treatment effects.</li>
</ul>
<div class="figure">
<img src="rsee_workflow.JPG" alt=""><p class="caption">RiskStratifiedEstimation package workflow </p>
</div>
</div>
<div class="section level2">
<h2 id="study-specification-and-database-selection">Study specification and database selection<a class="anchor" aria-label="anchor" href="#study-specification-and-database-selection"></a>
</h2>
<p>For the current demonstration we consider some of the treatments and
outcomes assessed in the Large-scale Evidence Generation in Network of
Databases (LEGEND) study for hypertension. The treatment cohort contains
patients with a hypertension diagnosis within the database that receive
angiotensin-converting enzyme (ACE) inhibitors, followed from the time
of initiation until the time of cessation. The comaparator cohort
contains the set of patients within the database with a hypertension
diagnosis that receive beta blockers. We also consider 2 outcome
cohorts. The first contains all patients found in the database that have
at least one occurrence of cardiovascular disease (CVD). The second
contains all patients with an occurrence of cough. We consider CVD as
the main outcome of interest that we are trying to prevent in the study
and cough as a common side-effect of ACE-inhibitors. Cohort definitions
are available online <a href="https://github.com/OHDSI/Legend" class="external-link">here</a>.</p>
<p>After the defining the problem we need to define the database on
which we will assess treatment effect heterogeneity. We need to make
sure that the defined cohorts are of adequate size to perform the
analysis. This is relevant to all cohorts defined. Very small treatment
or comparator cohorts reduce the power of our analyses restricting the
minimum detectable differences. Due to the stratified approach of the
framework this aspect is very relevant. The size of the outcome cohorts
is also very important for both the prediction and the estimation steps.
In the former case, low events per variable may limit the prediction
performance, while in the latter case, risk stratification may result to
in very few or even no observed cases in the lower strata.</p>
</div>
<div class="section level2">
<h2 id="study-implementation">Study implementation<a class="anchor" aria-label="anchor" href="#study-implementation"></a>
</h2>
<div class="section level3">
<h3 id="cohort-instantiation">Cohort instantiation<a class="anchor" aria-label="anchor" href="#cohort-instantiation"></a>
</h3>
<p>Similar to PLP package</p>
</div>
<div class="section level3">
<h3 id="study-script-creation">Study script creation<a class="anchor" aria-label="anchor" href="#study-script-creation"></a>
</h3>
<p>In this section we assume that our cohorts have been created and have
been extracted using a specific database. Then we can proceed with the
creation of the script that will perform the defined study. For this
part 7 types of input need to be created:</p>
<ul>
<li>connection details</li>
<li>anlaysis settings</li>
<li>database settings</li>
<li>Settnigs for getting the data</li>
<li>covariate settings</li>
<li>population settings</li>
<li>run settings</li>
</ul>
<div class="section level4">
<h4 id="analysis-settnigs">Analysis settnigs<a class="anchor" aria-label="anchor" href="#analysis-settnigs"></a>
</h4>
<p>The analysis settings refer to information that define the structure
of the study and can be used to identify it. The analysis id is
a–pereferably–unique identifier of the present study. The treatment
cohort id refers to the unique identifier of the treatment cohort
definition. In our case, that is <span class="math inline">\(1001\)</span> and refers to the extracted
hypertensive patients receving ACE-inhibitors. The comparator cohort id
refers to the unique identifier of the comparator cohort. In our case
this is <span class="math inline">\(1002\)</span> and refers to the
extracted cohort of hypertensive patients receiving beta blockers; the
outcome ids that refer to the unique identifiers of the outcome cohorts.
A very important characteristic of the analysis settings is the analysis
matrix, that dictates which comparisons are to be made. The columns of
this square boolean matrix refer to risk stratification outcomes and the
rows to estimation outcomes. Therefore, the default diagonal matrix
defines the following analyses:</p>
<ul>
<li>Within strata of CVD risk estimate relative and absolute treatment
effects of CVD events.</li>
<li>Within strata of acute myocardial infarction risk estimate relative
and absolute treatment effects of acute myocardial infarction
events.</li>
</ul>
<p>We can create the analysis settings using the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>analysisSettings <span class="ot">&lt;-</span> <span class="fu">createAnalysisSettings</span> (</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysisId =</span> <span class="st">"vignette_demonstration"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysisType =</span> <span class="st">"stratifyByPs"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="st">"description text"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatmentCohortId =</span> <span class="dv">1001</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">comparatorCohortId =</span> <span class="dv">1002</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcomeIds =</span> <span class="fu">c</span>(<span class="dv">131</span>, <span class="dv">102</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysisMatrix =</span> <span class="fu">diag</span>(<span class="dv">2</span>)),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>verbosity <span class="ot">=</span> <span class="st">"INFO"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>saveDirectory <span class="ot">=</span> <span class="st">"path/to/save/directory"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="er">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="connection-details">Connection details<a class="anchor" aria-label="anchor" href="#connection-details"></a>
</h4>
<p>We need to define our connection details that will be used to connect
to the database we have access to in order to construct extract the data
objects required for our analyses. They can be created from:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="va">dbms</span>,</span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"joe"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"secret"</span>,</span>
<span>  port <span class="op">=</span> <span class="va">port</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="database-settings">Database settings<a class="anchor" aria-label="anchor" href="#database-settings"></a>
</h4>
<p>The database settings contain relevant information on the database we
want to access. These refer to the database schema based on which we
extract our data along with the tables where the cohorts of interest are
stored. Note that we also need to create a table containing the merged
treatment and comparator cohorts that will be used to derive the
prediction models (requires write permission). Database settings can be
created from:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">databaseSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDatabaseSettings.html">createDatabaseSettings</a></span><span class="op">(</span></span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="st">"cdm_truven_mdcd_v780.dbo"</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="st">"Scratch.dbo"</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="st">"Scratch.dbo"</span>,</span>
<span>  resultsDatabaseSchema <span class="op">=</span> <span class="st">"Scratch.dbo"</span>,</span>
<span>  exposureDatabaseSchema <span class="op">=</span> <span class="st">"Scratch.dbo"</span>,</span>
<span>  cohortTable <span class="op">=</span> <span class="st">"ace_beta_cohorts"</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="st">"ace_beta_outcomes"</span>,</span>
<span>  exposureTable <span class="op">=</span> <span class="st">"ace_beta_cohorts"</span>,</span>
<span>  mergedCohortTable <span class="op">=</span> <span class="st">"ace_beta_merged"</span>,</span>
<span>  attributeDefinitionTable <span class="op">=</span> <span class="st">"ace_beta_def"</span>,</span>
<span>  cohortAttributeTable <span class="op">=</span> <span class="st">"ace_beta_attr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="settings-for-getting-the-data">Settings for getting the data<a class="anchor" aria-label="anchor" href="#settings-for-getting-the-data"></a>
</h4>
<p>There are two data objects that need to be defined. The prediction
data object that will be used for the derivation of the prediction
models used to risk stratify patients and the estimation data object
that will be used to estimate propensity scores and estimate treatment
effects within risk strata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getDataSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGetDataSettings.html">createGetDataSettings</a></span><span class="op">(</span></span>
<span>  getPlpDataSettings <span class="op">=</span> <span class="fu"><a href="../reference/createGetPlpDataArgs.html">createGetPlpDataArgs</a></span><span class="op">(</span></span>
<span>    washoutPeriod <span class="op">=</span> <span class="fl">365</span></span>
<span>  <span class="op">)</span>,</span>
<span>  getCmDataSettings <span class="op">=</span> <span class="fu"><a href="../reference/createGetCmDataArgs.html">createGetCmDataArgs</a></span><span class="op">(</span></span>
<span>    washoutPeriod <span class="op">=</span> <span class="fl">365</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="covariate-settings">Covariate settings<a class="anchor" aria-label="anchor" href="#covariate-settings"></a>
</h4>
<p>The purpose of the covariate settings is twofold. In the prediction
step they define the set of candidate predictors for the develppment of
the model. In the estimation step they define the set of candidate
confounders to be considered for the esitmation of the propensity
scores. In both cases we use the same covariate settings using a large
set of standardized covariates:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariateSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGetCovariateSettings.html">createGetCovariateSettings</a></span><span class="op">(</span></span>
<span>  covariateSettingsCm <span class="op">=</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createCovariateSettings.html" class="external-link">createCovariateSettings</a></span><span class="op">(</span></span>
<span>    useDemographicsGender <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDemographicsAge <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useConditionOccurrenceLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useConditionOccurrenceShortTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugExposureLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugExposureShortTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugEraLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugEraShortTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useCharlsonIndex <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    addDescendantsToExclude <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    excludedCovariateConceptIds <span class="op">=</span> </span>
<span>      <span class="va">excludedCovariateConceptIds</span>,</span>
<span>    addDescendantsToInclude <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  covariateSettingsPlp <span class="op">=</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createCovariateSettings.html" class="external-link">createCovariateSettings</a></span><span class="op">(</span></span>
<span>    useDemographicsGender <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDemographicsAge <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useConditionOccurrenceLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useConditionOccurrenceShortTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugExposureLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugExposureShortTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugEraLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugEraShortTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useCharlsonIndex <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    addDescendantsToExclude <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="population-settings">Population settings<a class="anchor" aria-label="anchor" href="#population-settings"></a>
</h4>
<p>The population settings contain additional restrictions for the
definitive target populations. Again in this case we need to define the
target population in the prediction step, based on which we will
actually develop the prediction models. In the estimation step the
population settings will define the population from which the propensity
score models will be derived and the treatment effects will be
estimated. The final populations may contain slightly different
patients. We can define the population settings from:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">populationSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createPopulationSettings.html">createPopulationSettings</a></span><span class="op">(</span></span>
<span>  populationPlpSettings <span class="op">=</span> <span class="fu">createPopulationPlpSettingsArgs</span><span class="op">(</span></span>
<span>    riskWindowEnd <span class="op">=</span> <span class="fl">365</span>,</span>
<span>    minTimeAtRisk <span class="op">=</span> <span class="fl">364</span></span>
<span>  <span class="op">)</span>,</span>
<span>  populationCmSettings <span class="op">=</span> <span class="fu">createPopulationCmSettingsArgs</span><span class="op">(</span></span>
<span>    removeDuplicateSubjects <span class="op">=</span> <span class="st">"keep first"</span>,</span>
<span>    removeSubjectsWithPriorOutcome <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    riskWindowStart <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    riskWindowEnd <span class="op">=</span> <span class="fl">9999</span>,</span>
<span>    minDaysAtRisk <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-settings">Run settings<a class="anchor" aria-label="anchor" href="#run-settings"></a>
</h4>
<p>Finally, we need to define the settings based on which the algorithms
in the prediction and estimation steps will be run. For example, in the
prediction step we need to define the prediction algorithm to be used
along with the hyperparameter parameter search strategy. In the
estimation step some of the settings we need to define the propensity
score method to be used for the estimation of the effects within risk
strata or the time point at which we will assess absolute and relative
risk differences. Since we mostly deal with time-to-event data this
means that absolute risk reduction is esimtated absed on the difference
on the Kaplan-Meier estimates at the specific time point. The run
settings can be created from:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createRunSettings.html">createRunSettings</a></span><span class="op">(</span></span>
<span>  runPlpSettings <span class="op">=</span> <span class="fu"><a href="../reference/createRunPlpSettingsArgs.html">createRunPlpSettingsArgs</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  runCmSettings <span class="op">=</span> <span class="fu"><a href="../reference/createRunCmSettingsArgs.html">createRunCmSettingsArgs</a></span><span class="op">(</span></span>
<span>    psMethod <span class="op">=</span> <span class="st">"stratifyByPs"</span>,</span>
<span>    effectEstimationSettings <span class="op">=</span> <span class="fu">createStratifyByPsAndCovariatesArgs</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    psSettings <span class="op">=</span> <span class="fu"><a href="../reference/createCreatePsArgs.html">createCreatePsArgs</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    fitOutcomeModelsThreads <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    timePoint <span class="op">=</span> <span class="fl">365</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="perform-the-analysis">Perform the analysis<a class="anchor" aria-label="anchor" href="#perform-the-analysis"></a>
</h4>
<p>Now that we have defined all the required settings objects, we can
proceed with running the actual analysis. One last setting that is
required is the location where the temporary files will be stored. The
user needs to have read and write permission. Run the analysis as
follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runRiskStratifiedEstimation.html">runRiskStratifiedEstimation</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  analysisSettings <span class="op">=</span> <span class="va">analysisSettings</span>,</span>
<span>  databaseSettings <span class="op">=</span> <span class="va">databaseSettings</span>,</span>
<span>  getDataSettings <span class="op">=</span> <span class="va">getDataSettings</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="va">covariateSettings</span>,</span>
<span>  populationSettings <span class="op">=</span> <span class="va">populationSettings</span>,</span>
<span>  runSettings <span class="op">=</span> <span class="va">runSettings</span>,</span>
<span>  tempDir <span class="op">=</span> <span class="st">"path/to/temporary/directory"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The analysis will usually take smome time to complete. All results
are saved on the hard drive in
<code>analysisSettings$saveDirectory</code>/<code>analysisSettings$analysisId</code></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="evaluation-of-results">Evaluation of results<a class="anchor" aria-label="anchor" href="#evaluation-of-results"></a>
</h2>
<p>The overall results are saved in a sub-directory called “shiny”. The
user can interactively explore the results of the performed analysis
using a shiny application. To launch it, the following command can be
used:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rseeViewer.html">rseeViewer</a></span><span class="op">(</span><span class="st">"path/to/shiny/directory"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alexandros Rekkas.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
